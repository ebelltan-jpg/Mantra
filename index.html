<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>莲花童子心咒精进系统</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600&display=swap');
    
    body {
      font-family: 'Noto Serif SC', serif;
      margin: 0;
      padding: 0;
      overflow: hidden;
    }
    
    .star {
      position: absolute;
      width: 2px;
      height: 2px;
      background: white;
      border-radius: 50%;
      animation: twinkle 3s infinite;
    }
    
    @keyframes twinkle {
      0%, 100% { opacity: 0.1; transform: scale(1); }
      50% { opacity: 0.4; transform: scale(1.5); }
    }
    
    @keyframes radiancePulse {
      0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
      50% { opacity: 1; }
      100% { transform: translate(-50%, -50%) scale(1.5); opacity: 0; }
    }
    
    @keyframes floatUp {
      0% { opacity: 0; transform: translateY(0) scale(0.8); }
      20% { opacity: 1; }
      70% { opacity: 0.7; }
      100% { opacity: 0; transform: translateY(-100px) scale(1); }
    }
    
    .radiance {
      animation: radiancePulse 1s ease-out;
    }
    
    .float-mantra {
      animation: floatUp 3s ease-out forwards;
    }

    /* 佛珠样式 */
    .bead {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      position: absolute;
      background: linear-gradient(135deg, #8B4513 0%, #A0522D 50%, #8B4513 100%);
      box-shadow: inset -2px -2px 4px rgba(0,0,0,0.3), inset 2px 2px 4px rgba(255,255,255,0.1);
      transition: all 0.3s ease;
    }
    
    .bead.active {
      background: linear-gradient(135deg, #FFD700 0%, #FFA500 50%, #FFD700 100%);
      box-shadow: 0 0 20px rgba(255, 215, 0, 0.8), inset -2px -2px 4px rgba(0,0,0,0.2);
      transform: scale(1.3);
    }
    
    .bead.passed {
      background: linear-gradient(135deg, #DAA520 0%, #B8860B 50%, #DAA520 100%);
      box-shadow: 0 0 8px rgba(218, 165, 32, 0.4), inset -2px -2px 4px rgba(0,0,0,0.2);
    }

    /* 佛珠中间的流苏 */
    .tassel {
      position: absolute;
      top: -30px;
      left: 50%;
      transform: translateX(-50%);
      width: 3px;
      height: 40px;
      background: linear-gradient(to bottom, #8B4513, #DAA520);
    }
    
    .tassel::after {
      content: '';
      position: absolute;
      bottom: -15px;
      left: 50%;
      transform: translateX(-50%);
      width: 20px;
      height: 20px;
      background: radial-gradient(circle, #DAA520 0%, #8B4513 100%);
      clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
    }

    @media (max-width: 1024px) {
      .layout-container {
        flex-direction: column !important;
        padding: 1rem !important;
      }
      .beads-section, .deity-section, .stats-section {
        width: 100% !important;
        margin-bottom: 2rem;
      }
      .deity-section img {
        width: 300px !important;
      }
      .mantra-button-main {
        width: 200px !important;
        height: 200px !important;
      }
    }
  </style>
</head>
<body>
  <div class="relative w-full h-screen overflow-hidden bg-gradient-to-b from-[#0a1628] via-[#1a2742] to-[#0f1b33]">
    <!-- 音效 -->
    <audio id="audio" preload="auto">
      <source src="./莲生_1.wav" type="audio/wav">
    </audio>

    <!-- 星光背景 -->
    <div id="stars" class="absolute inset-0"></div>
    
    <!-- 放射光晕容器 -->
    <div id="radiance-container" class="absolute inset-0 pointer-events-none"></div>
    
    <!-- 飘散咒语容器 -->
    <div id="mantra-container" class="absolute inset-0 pointer-events-none"></div>

    <!-- 三栏布局 -->
    <div class="layout-container absolute inset-0 flex items-center justify-between px-8">
      
      <!-- 左侧：佛珠 -->
      <div class="beads-section w-1/4 flex items-center justify-center">
        <div class="relative w-80 h-80">
          <!-- 流苏 -->
          <div class="tassel"></div>
          
          <!-- 佛珠圆圈 -->
          <div id="beads-container" class="relative w-full h-full"></div>
          
          <!-- 佛珠计数 -->
          <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-center">
            <div id="bead-progress" class="text-amber-300 text-3xl font-bold">0/108</div>
          </div>
        </div>
      </div>

      <!-- 中间：法相 -->
      <div class="deity-section w-2/4 flex items-center justify-center">
        <div id="deity" class="relative transition-all duration-100" style="opacity: 0.2;">
          <img src="./師尊2.png" alt="莲花童子法相" class="w-[500px] h-auto select-none" draggable="false">
        </div>
      </div>

      <!-- 右侧：今日精进 -->
      <div class="stats-section w-1/4 flex flex-col items-center justify-center gap-8">
        <div class="text-center">
          <p class="text-amber-100 text-lg tracking-widest mb-4">今日精进</p>
          <p id="today-count" class="text-white text-6xl mb-2">0</p>
          <p class="text-amber-200 text-2xl">/ 100,000 遍</p>
        </div>

        <div class="w-64">
          <div class="w-full h-3 bg-white/10 rounded-full overflow-hidden backdrop-blur-sm">
            <div id="progress-bar" class="h-full bg-gradient-to-r from-amber-400 to-amber-200 transition-all duration-500" style="width: 0%"></div>
          </div>
          <p id="progress-text" class="text-amber-200/60 text-sm text-center mt-3">还需 100,000 遍</p>
        </div>

        <div class="text-center mt-4">
          <p class="text-amber-100/60 text-sm mb-2">累积持诵</p>
          <p id="total-count" class="text-amber-100 text-3xl">0</p>
        </div>
      </div>
    </div>

    <!-- 底部按钮（完整圆形，咒语在里面） -->
    <div class="absolute bottom-12 left-1/2 -translate-x-1/2 z-20">
      <button id="mantra-button" class="mantra-button-main w-72 h-72 rounded-full bg-gradient-to-br from-amber-600/40 to-amber-900/40 
                   border-4 border-amber-400/60 backdrop-blur-md
                   flex items-center justify-center
                   shadow-[0_0_60px_rgba(251,191,36,0.5)]
                   cursor-pointer select-none
                   transition-all duration-150
                   hover:scale-105 active:scale-95
                   hover:shadow-[0_0_80px_rgba(251,191,36,0.7)]">
        <div class="text-center">
          <div class="text-amber-100 text-xl leading-loose mb-2">
            嗡。<br>
            咕噜。<br>
            莲生。<br>
            悉地。<br>
            吽。
          </div>
          <div class="text-amber-300 text-lg font-bold mt-3 tracking-widest">
            持咒计数
          </div>
        </div>
      </button>
    </div>
  </div>

  <script>
    const DAILY_GOAL = 100000;
    const TOTAL_BEADS = 108;
    const MANTRA_TEXT = "嗡。咕噜。莲生。悉地。吽。";
    
    let totalCount = 0;
    let todayCount = 0;
    let currentBead = 0;
    let beadElements = [];
    
    // 初始化星光
    const starsContainer = document.getElementById('stars');
    for (let i = 0; i < 50; i++) {
      const star = document.createElement('div');
      star.className = 'star';
      star.style.left = Math.random() * 100 + '%';
      star.style.top = Math.random() * 100 + '%';
      star.style.animationDelay = Math.random() * 2 + 's';
      star.style.animationDuration = (Math.random() * 3 + 2) + 's';
      starsContainer.appendChild(star);
    }
    
    // 初始化佛珠（更大、更立体）
    const beadsContainer = document.getElementById('beads-container');
    for (let i = 0; i < TOTAL_BEADS; i++) {
      const angle = (i * 360) / TOTAL_BEADS - 90;
      const radian = (angle * Math.PI) / 180;
      const radius = 150;
      const x = Math.cos(radian) * radius;
      const y = Math.sin(radian) * radius;
      
      const bead = document.createElement('div');
      bead.className = 'bead';
      bead.style.left = '50%';
      bead.style.top = '50%';
      bead.style.transform = `translate(${x}px, ${y}px) translate(-50%, -50%)`;
      
      beadsContainer.appendChild(bead);
      beadElements.push(bead);
    }
    
    // 更新佛珠状态
    function updateBeads() {
      beadElements.forEach((bead, i) => {
        const isActive = i === currentBead;
        const isPassed = i < currentBead;
        
        bead.classList.remove('active', 'passed');
        
        if (isActive) {
          bead.classList.add('active');
        } else if (isPassed) {
          bead.classList.add('passed');
        }
      });
    }
    
    // 加载数据
    function loadData() {
      try {
        const stored = localStorage.getItem('mantraData');
        if (stored) {
          const data = JSON.parse(stored);
          const today = new Date().toDateString();
          
          if (data.date === today) {
            todayCount = data.todayCount;
          } else {
            todayCount = 0;
            saveData(data.totalCount, 0);
          }
          totalCount = data.totalCount;
          currentBead = todayCount % TOTAL_BEADS;
        }
      } catch (e) {
        console.log('加载数据失败:', e);
      }
      updateDisplay();
      updateBeads();
    }
    
    // 保存数据
    function saveData(newTotal, newToday) {
      try {
        const today = new Date().toDateString();
        localStorage.setItem('mantraData', JSON.stringify({
          totalCount: newTotal,
          todayCount: newToday,
          date: today
        }));
      } catch (e) {
        console.log('保存数据失败:', e);
      }
    }
    
    // 更新显示
    function updateDisplay() {
      document.getElementById('total-count').textContent = totalCount.toLocaleString();
      document.getElementById('today-count').textContent = todayCount.toLocaleString();
      document.getElementById('bead-progress').textContent = `${currentBead}/108`;
      
      const progressPercentage = Math.min((todayCount / DAILY_GOAL) * 100, 100);
      document.getElementById('progress-bar').style.width = progressPercentage + '%';
      
      if (todayCount >= DAILY_GOAL) {
        document.getElementById('progress-text').textContent = '✨ 今日目标已达成 ✨';
      } else {
        document.getElementById('progress-text').textContent = `还需 ${(DAILY_GOAL - todayCount).toLocaleString()} 遍`;
      }
    }
    
    // 点击按钮
    document.getElementById('mantra-button').addEventListener('click', function() {
      totalCount++;
      todayCount++;
      currentBead = todayCount % TOTAL_BEADS;
      
      saveData(totalCount, todayCount);
      updateDisplay();
      updateBeads();
      
      // 播放音效
      const audio = document.getElementById('audio');
      audio.currentTime = 0;
      audio.play().catch(err => console.log('音效播放失败:', err));
      
      // 激活法相
      const deity = document.getElementById('deity');
      deity.style.opacity = '1';
      deity.style.transform = 'translateY(-10px)';
      
      // 显示放射光晕
      const radiance = document.createElement('div');
      radiance.className = 'radiance absolute top-1/2 left-1/2 w-[1000px] h-[1000px] rounded-full pointer-events-none';
      radiance.style.background = 'radial-gradient(circle, rgba(255,215,0,0.6) 0%, rgba(255,215,0,0.3) 30%, transparent 70%)';
      document.getElementById('radiance-container').appendChild(radiance);
      
      setTimeout(() => radiance.remove(), 1000);
      
      // 创建飘散咒语
      const mantra = document.createElement('div');
      mantra.className = 'float-mantra absolute text-amber-300 text-2xl pointer-events-none font-bold';
      mantra.textContent = MANTRA_TEXT;
      mantra.style.left = (Math.random() * 30 + 35) + '%';
      mantra.style.top = (Math.random() * 30 + 35) + '%';
      document.getElementById('mantra-container').appendChild(mantra);
      
      setTimeout(() => mantra.remove(), 3000);
      
      // 1秒后恢复静默
      setTimeout(() => {
        deity.style.opacity = '0.2';
        deity.style.transform = 'translateY(0)';
      }, 1000);
    });
    
    // 初始化
    loadData();
  </script>
</body>
</html>
